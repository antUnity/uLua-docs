<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.4"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>uLua: uLua</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">uLua<span id="projectnumber">&#160;v1.2.1</span>
   </div>
   <div id="projectbrief">A Lua Modding Framework for Unity.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.4 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('index.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title"><a class="el" href="namespaceu_lua.html" title="Namespace containing the uLua project.">uLua</a> </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p ><a class="anchor" id="md_C__Users_Aris_Documents_Projects_Titania_uTitania_Assets_Plugins_uLua_README"></a> <a class="el" href="namespaceu_lua.html" title="Namespace containing the uLua project.">uLua</a> is a Lua Modding framework for Unity. It enables the development of a Lua API which may be used to mod your Unity Project.</p>
<p ><a class="el" href="namespaceu_lua.html" title="Namespace containing the uLua project.">uLua</a> wraps around MoonSharp and provides an object oriented Lua Modding framework. It works by setting up an application-wide Lua context and exposing game objects to it. Objects exposed to the Lua context can then be accessed in Lua, allowing users to modify your game at runtime through the use of Lua scripts.</p>
<p ><a class="el" href="namespaceu_lua.html" title="Namespace containing the uLua project.">uLua</a> includes the following features:</p><ul>
<li>Lua script execution from the Resources folder or an external directory.</li>
<li>Event system which allows events to be invoked in C# and handled in Lua.</li>
<li>Base classes to expose your game objects and data structures to Lua.</li>
<li>Callback system for your Lua objects.</li>
<li>Ability to override C# methods in Lua.</li>
</ul>
<h1><a class="anchor" id="autotoc_md1"></a>
Dependencies</h1>
<ul>
<li><a href="https://assetstore.unity.com/packages/tools/moonsharp-33776">MoonSharp for Unity</a></li>
</ul>
<h1><a class="anchor" id="autotoc_md2"></a>
Documentation</h1>
<p >This is the complete documentation for <a class="el" href="namespaceu_lua.html" title="Namespace containing the uLua project.">uLua</a>. For any further questions do not hesitate to contact <a href="#" onclick="location.href='mai'+'lto:'+'sup'+'po'+'rt@'+'an'+'tso'+'ft'+'war'+'e.'+'co.'+'uk'; return false;">suppo<span class="obfuscator">.nosp@m.</span>rt@a<span class="obfuscator">.nosp@m.</span>ntsof<span class="obfuscator">.nosp@m.</span>twar<span class="obfuscator">.nosp@m.</span>e.co.<span class="obfuscator">.nosp@m.</span>uk</a>.</p>
<p >I have put together a demo game which uses <a class="el" href="namespaceu_lua.html" title="Namespace containing the uLua project.">uLua</a>, and which comes with its own documentation of the API and source code. You may find it <a href="https://bit.ly/PaddleDemo">here</a>.</p>
<p >This project is the result of many hours of hard work. Please support me by leaving a review on the asset store! Follow my <a href="https://twitter.com/_ANTSoftware" title="@_ANTSoftware">Twitter</a>!</p>
<h1><a class="anchor" id="autotoc_md3"></a>
Usage Tutorial</h1>
<p ><b>Note: You must install the Unity MoonSharp plugin before you can use <a class="el" href="namespaceu_lua.html" title="Namespace containing the uLua project.">uLua</a>. Check the <em>Dependencies</em> section above.</b></p>
<p ><a class="el" href="namespaceu_lua.html" title="Namespace containing the uLua project.">uLua</a> consists of the following main scripts:</p><ul>
<li><b><a class="el" href="classu_lua_1_1_lua.html" title="Wrapper class which streamlines use of the MoonSharp Lua context.">uLua.Lua</a>:</b> A wrapper class providing an application-wide Lua context.</li>
<li><b><a class="el" href="classu_lua_1_1_a_p_i.html" title="This script sets up the API framework to your Unity scene.">uLua.API</a>:</b> Class that implements an event handling system and a script execution framework.</li>
<li><b><a class="el" href="classu_lua_1_1_exposed_class.html" title="Class structure exposed to Lua. You should use this class as a base for your API data structures.">uLua.ExposedClass</a>:</b> Class which exposes its instances to Lua. To use as a base for data structures which will be accessible in your API.</li>
<li><b><a class="el" href="classu_lua_1_1_exposed_mono_behaviour.html" title="MonoBehaviour script exposed to Lua. You should use this class as a base for your API game objects.">uLua.ExposedMonoBehaviour</a>:</b> MonoBehaviour script which exposes its instances to Lua. To use as a base for game objects which will be accessible in your API.</li>
</ul>
<p >The following tutorial is a thorough introduction to the different classes and scripts in the <a class="el" href="namespaceu_lua.html" title="Namespace containing the uLua project.">uLua</a> toolkit and will walk you through performing basic tasks with <a class="el" href="namespaceu_lua.html" title="Namespace containing the uLua project.">uLua</a>.</p>
<h2><a class="anchor" id="autotoc_md4"></a>
1. The API class</h2>
<p >The <a class="el" href="classu_lua_1_1_a_p_i.html" title="This script sets up the API framework to your Unity scene.">uLua.API</a> class sets up various aspects of the <a class="el" href="namespaceu_lua.html" title="Namespace containing the uLua project.">uLua</a> framework such as script execution directories and the event handling system.</p>
<p >To start using <a class="el" href="namespaceu_lua.html" title="Namespace containing the uLua project.">uLua</a>, add the <a class="el" href="classu_lua_1_1_a_p_i.html" title="This script sets up the API framework to your Unity scene.">uLua.API</a> script to an object in your Unity scene.</p>
<p >The following settings can be configured in the inspector UI:</p><ul>
<li><b>ResourcePath</b>: Path for Lua scripts within the Resources folder.</li>
<li><b>ExternalDirectory</b>: Directory for external Lua scripts. <code>Application.persistentDataPath</code> is used unless otherwise specified.</li>
<li><b>SaveDataPath</b>: Path for user save data under <code>ExternalDirectory</code>.</li>
<li><b>UserScriptsPath</b>: Path for user scripts under <code>ExternalDirectory</code>. Scripts in this path are loaded automatically and executed if <code>EnableUserScripts</code> is enabled.</li>
<li><b>LuaScriptsExtension</b>: The file extension for all external Lua scripts. Set to <em>lua</em> by default.</li>
<li><b>EnableSceneScript</b>: If enabled, the <a class="el" href="classu_lua_1_1_a_p_i.html" title="This script sets up the API framework to your Unity scene.">uLua.API</a> class attempts to load a script by the name of the scene. The scene script may be located in the <code>ResourcePath</code> or in the <code>UserScriptsPath</code>.</li>
<li><b>EnableUserScripts</b>: If enabled, allows user scripts to be executed which extend the <code>SceneScript</code>.</li>
<li><b>EnableConsoleMessages</b>: If enabled, messages will be output to the console at runtime.</li>
</ul>
<p >The <a class="el" href="classu_lua_1_1_a_p_i.html" title="This script sets up the API framework to your Unity scene.">uLua.API</a> class implements various static methods which will be useful as you develop your API. These methods are introduced in the sections below.</p>
<p >For now, you can stick to the default settings and continue to the next section.</p>
<h2><a class="anchor" id="autotoc_md5"></a>
2. Executing Lua scripts</h2>
<p >The <a class="el" href="classu_lua_1_1_a_p_i.html" title="This script sets up the API framework to your Unity scene.">uLua.API</a> class provides a scripting framework which allows you to execute Lua code by wrapping around the MoonSharp Lua interpreter. Lua scripts may be executed from the Resources folder of your project or from an external directory.</p>
<p >In the following sections we will go through different approaches to executing Lua scripts.</p>
<h3><a class="anchor" id="autotoc_md6"></a>
2.1. Loading a Scene Script</h3>
<p >A scene script is a Lua script which is executed as soon the scene is loaded. To enable scene scripts, use the <code>EnableSceneScript</code> option of the <a class="el" href="classu_lua_1_1_a_p_i.html" title="This script sets up the API framework to your Unity scene.">uLua.API</a> class on the inspector UI.</p>
<p >As an example consider that your scene is named <code>MyGameScene</code>. You may create the following script to execute a print command.</p>
<p ><em><b>MyGameScene.lua</b></em> </p><div class="fragment"><div class="line">print (&quot;Hello World!&quot;);</div>
</div><!-- fragment --><p >To execute this script, create a file named <em><b>MyGameScene.lua</b></em> and place it at the <code>ResourcePath</code> under the Resources folder in your project. The <code>ResourcePath</code> is set to the folder "Scripts" by default, which means the scene script would have to be placed in the following path:</p>
<div class="fragment"><div class="line">Resources/Scripts/MyGameScene.lua</div>
</div><!-- fragment --><p >When you run your scene in the editor, you should notice the message "Hello World!" output to the console. Congratulations, you have executed your first Lua script!</p>
<h3><a class="anchor" id="autotoc_md7"></a>
2.2. Loading a Scene Script Externally</h3>
<p >The <a class="el" href="classu_lua_1_1_a_p_i.html" title="This script sets up the API framework to your Unity scene.">uLua.API</a> class also allows you to load the scene script from an external directory. To do so, you must use the <code>EnableUserScripts</code> option of the <a class="el" href="classu_lua_1_1_a_p_i.html" title="This script sets up the API framework to your Unity scene.">uLua.API</a> class from the inspector UI. You must then move your scene script to the external directory under the <code>UserScriptsPath</code>. When loaded externally, the scene script must be placed in a folder which is named after the scene.</p>
<p >The directory path would be the following in this example:</p>
<div class="fragment"><div class="line">{ExternalDirectory}/{UserScriptsPath}/MyGameScene/MyGameScene.lua</div>
</div><!-- fragment --><p ><em>Note: The external directory is set to Unity's <code>Application.persistentDataPath</code> by default. For more information about this directory path, check the <a href="https://docs.unity3d.com/ScriptReference/Application-persistentDataPath.html">relevant Unity documentation</a>.</em></p>
<p ><em>Note: The <code>UserScriptsPath</code> is set to the folder "Scripts" by default.</em></p>
<p >Place your script in the appropriate directory and run the scene in the editor. You should notice the message "Hello World!" output to the console.</p>
<p >When the <code>EnableSceneScript</code> option is enabled, the <a class="el" href="classu_lua_1_1_a_p_i.html" title="This script sets up the API framework to your Unity scene.">uLua.API</a> class will attempt to load the scene script from the external directory <b>first</b>. If the scene script is not found in the external directory, it will then be loaded from the Resources folder. The intended use of this feature is to allow users to override the default implementation of scene scripts by redefining them at runtime. This is very useful if you want to allow users to modify your game behaviour.</p>
<h3><a class="anchor" id="autotoc_md8"></a>
2.3. User Scripts</h3>
<p >In the previous section we explained how users can override a scene script. While that is useful, there are times when simply extending your scene script is all that is needed.</p>
<p >The <a class="el" href="classu_lua_1_1_a_p_i.html" title="This script sets up the API framework to your Unity scene.">uLua.API</a> class can load additional user scripts which are executed after the scene script. To enable user scripts, use the <code>EnableUserScripts</code> option in the inspector UI.</p>
<p >User scripts are indexed and loaded automatically as long as they are placed in an appropriate path under the external directory. The following paths are parsed for user scripts:</p>
<div class="fragment"><div class="line">{ExternalDirectory}/{UserScriptsPath}/</div>
<div class="line">{ExternalDirectory}/{UserScriptsPath}/MyGameScene/</div>
</div><!-- fragment --><p >Any scripts found in these path will be executed by the <a class="el" href="classu_lua_1_1_a_p_i.html" title="This script sets up the API framework to your Unity scene.">uLua.API</a> class <b>after</b> the scene script is executed. Scripts placed under the <code>MyGameScene</code> folder will only be loaded when that scene is active (i.e. a scene named <code>MyGameScene</code>). Scripts placed in the <code>UserScriptsPath</code> path will be loaded independently of which scene is loaded.</p>
<p >As an example, you may create the following Lua script and place it in one of those two directories:</p>
<p ><em><b>MyUserScript.lua</b></em> </p><div class="fragment"><div class="line">print (&quot;This is a user script.&quot;);</div>
</div><!-- fragment --><p >Run your scene and you should notice the following two messages output to the console:</p>
<div class="fragment"><div class="line">Hello World!</div>
<div class="line">This is a user script.</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md9"></a>
2.4. Manual Script Execution</h3>
<p >So far we have used the different inspector settings of the <a class="el" href="classu_lua_1_1_a_p_i.html" title="This script sets up the API framework to your Unity scene.">uLua.API</a> class to execute Lua scripts. However, the default functionality implemented in <a class="el" href="classu_lua_1_1_a_p_i.html" title="This script sets up the API framework to your Unity scene.">uLua.API</a> may not always fit your project workflow. For this reason, the <a class="el" href="classu_lua_1_1_a_p_i.html" title="This script sets up the API framework to your Unity scene.">uLua.API</a> class also allows you to execute Lua scripts on demand from anywhere in your project.</p>
<p >The following two static methods are available to use in your code:</p>
<p ><a class="el" href="classu_lua_1_1_a_p_i.html#a7b506958b718c9b3917e917544b05449" title="Executes a script from the external directory.">uLua.API.ExecuteExternalFile()</a></p>
<p ><a class="el" href="classu_lua_1_1_a_p_i.html#a9a5ef26647eabe286c7903ce1be3b68c" title="Executes a script from the resource directory.">uLua.API.ExecuteFile()</a></p>
<p >These methods make use of the script execution framework defined by <a class="el" href="classu_lua_1_1_a_p_i.html" title="This script sets up the API framework to your Unity scene.">uLua.API</a>. This means that you do not need to specify the execution directories when calling these functions. As long as a game object with your <a class="el" href="classu_lua_1_1_a_p_i.html" title="This script sets up the API framework to your Unity scene.">uLua.API</a> settings is set up in your scene, you can execute external or internal Lua scripts by the path to their filename. Check the full documentation for a list of available parameters and more information on how to use these methods.</p>
<h2><a class="anchor" id="autotoc_md10"></a>
3. Using the Event System</h2>
<p >In the previous section we went over the Lua script execution framework of <a class="el" href="classu_lua_1_1_a_p_i.html" title="This script sets up the API framework to your Unity scene.">uLua.API</a>. Another main feature of <a class="el" href="classu_lua_1_1_a_p_i.html" title="This script sets up the API framework to your Unity scene.">uLua.API</a> is its event system. Events are very useful when implementing game behaviour, and <a class="el" href="namespaceu_lua.html" title="Namespace containing the uLua project.">uLua</a> allows you to invoke game events and handle them by implementing event handlers in Lua.</p>
<h3><a class="anchor" id="autotoc_md11"></a>
3.1. Invoking Events</h3>
<p >Events are invoked by the <a class="el" href="classu_lua_1_1_a_p_i.html" title="This script sets up the API framework to your Unity scene.">uLua.API</a> class. The related method is static, which means it can be executed from anywhere in your project. For instance, to invoke an event named <code>PlayerHealthChanged</code> you can use the following command anywhere in your scene: </p><div class="fragment"><div class="line">uLua.API.Invoke(&quot;PlayerHealthChanged&quot;);</div>
</div><!-- fragment --><p >When invoking an event, you may pass any arguments as optional parameters following the event name. For instance:</p>
<div class="fragment"><div class="line">uLua.API.Invoke(&quot;MyEventWithParameters&quot;, 5, 1, &quot;text&quot;);</div>
</div><!-- fragment --><p >You may also invoke an event in a Lua script with the same syntax:</p>
<div class="fragment"><div class="line">Invoke(&quot;MyEventWithParameters&quot;, 5, 1, &quot;text&quot;);</div>
</div><!-- fragment --><p >You can name your game events whatever you like, however, the same event name must be used in the event handler registration.</p>
<h3><a class="anchor" id="autotoc_md12"></a>
3.2. Registering Event Handlers</h3>
<p >Event handlers are registered and removed by the <a class="el" href="classu_lua_1_1_a_p_i.html" title="This script sets up the API framework to your Unity scene.">uLua.API</a> class. The related methods are static, which means they can be executed from anywhere in your project. Until an event handler has been registered, the <a class="el" href="classu_lua_1_1_a_p_i.html#ae85b13a4101bcfca3c7ad3e552d5e7cf" title="Invokes a game event.">uLua.API.Invoke()</a> command will have no effect.</p>
<p >To register an event handler for the <code>PlayerHealthChanged</code> event you can use the following command in C#: </p><div class="fragment"><div class="line">uLua.API.RegisterEventHandler(&quot;PlayerHealthChanged&quot;, &quot;OnPlayerHealthChanged&quot;);</div>
</div><!-- fragment --><p >This command registers the <code>OnPlayerHealthChanged</code> global Lua function to be called when the <code>PlayerHealthChanged</code> event is invoked. The event handler <code>OnPlayerHealthChanged</code> must be defined <em><b>before</b></em> the <a class="el" href="classu_lua_1_1_a_p_i.html#a54e04f2dc4e28c911fe96e68a00d8537" title="Registers an event handler to be called when an event is invoked.">uLua.API.RegisterEventHandler()</a> command is called, otherwise invoking the <code>PlayerHealthChanged</code> event will cause a runtime exception.</p>
<p ><em>Note: Keep in mind that event handlers can be registered as members of other objects in Lua by using an optional third argument. For the sake of simplicity, we use a global event handler in this step of the tutorial.</em></p>
<p >You can now use your scene script to implement the <code>OnPlayerHealthChanged</code> function.</p>
<p ><em><b>MyGameScene.lua</b></em> </p><div class="fragment"><div class="line">function OnPlayerHealthChanged()</div>
<div class="line">    -- Do stuff</div>
<div class="line">end</div>
</div><!-- fragment --><p >Any arguments passed to the <a class="el" href="classu_lua_1_1_a_p_i.html#ae85b13a4101bcfca3c7ad3e552d5e7cf" title="Invokes a game event.">uLua.API.Invoke()</a> method are automatically handled in Lua and can be included in the event handler definition. For instance: </p><div class="fragment"><div class="line">function MyHandlerWithParameters(arg1, arg2, arg3)</div>
<div class="line">    -- Do stuff with arg1, arg2, arg3</div>
<div class="line">end</div>
</div><!-- fragment --><p >The methods to register and remove event handlers are also available in Lua. As a result the same event handler may instead be registered in your Lua scene script using a similar syntax. Returning to our previous example:</p>
<p ><em><b>MyGameScene.lua</b></em> </p><div class="fragment"><div class="line">function OnPlayerHealthChanged()</div>
<div class="line">    -- Do stuff</div>
<div class="line">end</div>
<div class="line"> </div>
<div class="line">RegisterEventHandler(&quot;PlayerHealthChanged&quot;, &quot;OnPlayerHealthChanged&quot;);</div>
</div><!-- fragment --><p >These two approaches are equivalent in functionality. However, allowing event handlers to be registered by the user in Lua scripts allows for a lot more flexibility in script design.</p>
<h3><a class="anchor" id="autotoc_md13"></a>
3.3. Removing Event Handlers</h3>
<p >Event handlers may be removed by calling the following command in C#: </p><div class="fragment"><div class="line">uLua.API.RemoveEventHandlers();</div>
</div><!-- fragment --><p >Or the following equivalent command in a Lua script: </p><div class="fragment"><div class="line">RemoveEventHandlers();</div>
</div><!-- fragment --><p >These commands remove all <em>global</em> event handlers.</p>
<p ><em>Note: Again, keep in mind that event handlers are not exclusively globals. Event handlers for a specific object are removed by using an optional third argument. For the sake of simplicity, we use global event handlers in this step of the tutorial.</em></p>
<h3><a class="anchor" id="autotoc_md14"></a>
3.4. The SceneLoaded / SceneUnloaded Events</h3>
<p >The <a class="el" href="classu_lua_1_1_a_p_i.html" title="This script sets up the API framework to your Unity scene.">uLua.API</a> class invokes a few events by default, including the <code>SceneLoaded</code> and <code>SceneUnloaded</code> events. The <code>SceneLoaded</code> event is invoked after the scene script is executed, and before any user scripts are executed. The <code>SceneUnloaded</code> event is invoked when a scene is unloaded. You may register an event handler for these events as you would for any other event. For instance, you could add the following event handlers to set up your scene:</p>
<p ><em><b>MyGameScene.lua</b></em> </p><div class="fragment"><div class="line">function OnPlayerHealthChanged()</div>
<div class="line">    -- Do stuff</div>
<div class="line">end</div>
<div class="line"> </div>
<div class="line">function OnSceneLoaded()</div>
<div class="line">    -- Do other stuff</div>
<div class="line">end</div>
<div class="line"> </div>
<div class="line">function OnSceneUnloaded()</div>
<div class="line">    RemoveEventHandlers();</div>
<div class="line">end</div>
<div class="line"> </div>
<div class="line">RegisterEventHandler(&quot;PlayerHealthChanged&quot;, &quot;OnPlayerHealthChanged&quot;);</div>
<div class="line">RegisterEventHandler(&quot;SceneLoaded&quot;, &quot;OnSceneLoaded&quot;);</div>
<div class="line">RegisterEventHandler(&quot;SceneUnloaded&quot;, &quot;OnSceneUnloaded&quot;);</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md15"></a>
4. Exposing Objects to Lua</h2>
<p >In the previous two sections we have shown how the scene script can be structured to handle events invoked in your Unity scene. However, the API that we have set up so far has no game objects exposed to it that would allow us to implement game behaviour.</p>
<p >To expose objects to the Lua API, <a class="el" href="namespaceu_lua.html" title="Namespace containing the uLua project.">uLua</a> provides two approaches: the <a class="el" href="classu_lua_1_1_exposed_class.html" title="Class structure exposed to Lua. You should use this class as a base for your API data structures.">uLua.ExposedClass</a> and <a class="el" href="classu_lua_1_1_exposed_mono_behaviour.html" title="MonoBehaviour script exposed to Lua. You should use this class as a base for your API game objects.">uLua.ExposedMonoBehaviour</a> classes. Any script that inherits these classes will automatically expose its instances as objects of the API.</p>
<p >When exposing game objects to the API, the <a class="el" href="namespaceu_lua.html" title="Namespace containing the uLua project.">uLua</a> framework uses an object-oriented approach. Each game object is exposed to the API with a unique Lua handle. As we will explore in the following sections, this becomes important when developing your API and structuring your API object scripts.</p>
<h3><a class="anchor" id="autotoc_md16"></a>
4.1. The ExposedMonoBehaviour script</h3>
<p ><a class="el" href="classu_lua_1_1_exposed_mono_behaviour.html" title="MonoBehaviour script exposed to Lua. You should use this class as a base for your API game objects.">uLua.ExposedMonoBehaviour</a> is a MonoBehaviour script. It may be used as a component similarly to MonoBehaviour, but has the added functionality of exposing itself to Lua.</p>
<p >When a class inherits <a class="el" href="classu_lua_1_1_exposed_mono_behaviour.html" title="MonoBehaviour script exposed to Lua. You should use this class as a base for your API game objects.">uLua.ExposedMonoBehaviour</a>, all its public members are accessible in Lua. This makes <a class="el" href="classu_lua_1_1_exposed_mono_behaviour.html" title="MonoBehaviour script exposed to Lua. You should use this class as a base for your API game objects.">uLua.ExposedMonoBehaviour</a> the base for developing your API objects.</p>
<p >As an example, let's assume you want to expose your <code>Player</code> object to Lua. For simplicity, let's say the Player has only one member: its health. You may start by defining a <code>Player</code> script which inherits ExposedMonoBehaviour:</p>
<p ><em><b>Player.cs</b></em> </p><div class="fragment"><div class="line">using uLua;</div>
<div class="line"> </div>
<div class="line">public class Player : ExposedMonoBehaviour {</div>
<div class="line">    public int Health = 100;</div>
<div class="line">}</div>
</div><!-- fragment --><p >You may now attach the <code>Player</code> script to a game object in your scene. As an example let's name that object <code>MyPlayer</code>. By default, the <a class="el" href="classu_lua_1_1_exposed_mono_behaviour.html" title="MonoBehaviour script exposed to Lua. You should use this class as a base for your API game objects.">uLua.ExposedMonoBehaviour</a> class will use the game object's name to generate a handle in Lua. This means that a game object named <code>MyPlayer</code> in your Unity Scene will be accessible by the same name in Lua.</p>
<p >You can specify a different name for your ExposedMonoBehaviour objects by using the <code>Name</code> field in the Unity inspector or in a script. This allows you to separate the game object name from the ExposedMonoBehaviour name. In addition, it allows multiple ExposedMonoBehaviour components to be attached to the same game object, while being accessed as separate objects in Lua. For this tutorial, you should leave the <code>Name</code> field blank.</p>
<p ><em>Note: Game objects may not include spaces or special characters in their name if they are to be exposed to Lua. Object names must follow Lua naming conventions for variables.</em></p>
<p >By default, all game objects which contain the <code>Player</code> script will be exposed to the API when the object's <code>Start()</code> method is called. This option may be changed by setting the <code>ExposeOn</code> parameter of <a class="el" href="classu_lua_1_1_exposed_mono_behaviour.html" title="MonoBehaviour script exposed to Lua. You should use this class as a base for your API game objects.">uLua.ExposedMonoBehaviour</a> to <code>Awake</code>, or to <code>None</code>, allowing you to expose objects manually by using <a class="el" href="classu_lua_1_1_a_p_i.html#aad4b6cab0c4aac473d9c42aea6902556" title="Exposes an object to Lua.">uLua.API.Expose&lt;T&gt;()</a>.</p>
<p >The <code>Player</code> script we defined above has a public field named Health. Building on the <em>MyGameScene.lua</em> script from the previous section, the following script shows how the object <code>MyPlayer</code> and its member <code>Health</code> are now accessible in Lua:</p>
<p ><em><b>MyGameScene.lua</b></em> </p><div class="fragment"><div class="line">function OnPlayerHealthChanged()</div>
<div class="line">    -- Do stuff</div>
<div class="line">end</div>
<div class="line"> </div>
<div class="line">function OnSceneLoaded()</div>
<div class="line">    print (MyPlayer.Health);</div>
<div class="line">end</div>
<div class="line"> </div>
<div class="line">function OnSceneUnloaded()</div>
<div class="line">    RemoveEventHandlers();</div>
<div class="line">end</div>
<div class="line"> </div>
<div class="line">RegisterEventHandler(&quot;PlayerHealthChanged&quot;, &quot;OnPlayerHealthChanged&quot;);</div>
<div class="line">RegisterEventHandler(&quot;SceneLoaded&quot;, &quot;OnSceneLoaded&quot;);</div>
<div class="line">RegisterEventHandler(&quot;SceneUnloaded&quot;, &quot;OnSceneUnloaded&quot;);</div>
</div><!-- fragment --><p >The above script will output the health of the object <code>MyPlayer</code> to the console when the scene is loaded.</p>
<p >It is important to note that the Lua object <code>MyPlayer</code> is a reference, not a copy of the Unity object. This means that if the <code>Health</code> member is altered in Lua, its value in Unity will also change.</p>
<p >To make use of the <code>PlayerHealthChanged</code> event, we can build on the <code>Player</code> class design. In the modification below, we have made the <code>Health</code> variable private and renamed it to <code>_Health</code>. We then implement a public getter property named <code>Health</code>, and a public method named <code>Damage()</code>. The <code>Damage()</code> method changes the value of <code>_Health</code> and invokes the <code>PlayerHealthChanged</code> event.</p>
<p ><em><b>Player.cs</b></em> </p><div class="fragment"><div class="line">using uLua;</div>
<div class="line"> </div>
<div class="line">public class Player : ExposedMonoBehaviour {</div>
<div class="line">    private int _Health = 100;</div>
<div class="line"> </div>
<div class="line">    public void Damage(int Damage) {</div>
<div class="line">        _Health -= Damage;</div>
<div class="line"> </div>
<div class="line">        API.Invoke(&quot;PlayerHealthChanged&quot;);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    public int Health {</div>
<div class="line">        get { return _Health; }</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><p >You may then use the <code>Damage()</code> method in Lua, and also make use of the invoked event <code>PlayerHealthChanged</code> as shown below:</p>
<p ><em><b>MyGameScene.lua</b></em> </p><div class="fragment"><div class="line">function OnPlayerHealthChanged()</div>
<div class="line">    print (MyPlayer.Health);</div>
<div class="line">end</div>
<div class="line"> </div>
<div class="line">function OnSceneLoaded()</div>
<div class="line">    print (MyPlayer.Health);</div>
<div class="line">    </div>
<div class="line">    MyPlayer:Damage(5);</div>
<div class="line">end</div>
<div class="line"> </div>
<div class="line">function OnSceneUnloaded()</div>
<div class="line">    RemoveEventHandlers();</div>
<div class="line">end</div>
<div class="line"> </div>
<div class="line">RegisterEventHandler(&quot;PlayerHealthChanged&quot;, &quot;OnPlayerHealthChanged&quot;);</div>
<div class="line">RegisterEventHandler(&quot;SceneLoaded&quot;, &quot;OnSceneLoaded&quot;);</div>
<div class="line">RegisterEventHandler(&quot;SceneUnloaded&quot;, &quot;OnSceneUnloaded&quot;);</div>
</div><!-- fragment --><p >The above example covers the most basic usage of this toolkit. It is recommended you experiment until you find a design that works for your game objects. For instance, if your Player object is comprised of several components (as is common in Unity), and you need properties of these components to be accessible in Lua, then you will have to write part of your <code>Player</code> script as a wrapper class, implementing getter and setter properties for its components as necessary for your Lua API. Alternatively, you may implement multiple components as an ExposedMonoBehaviour and expose them under a different name in Lua.</p>
<h3><a class="anchor" id="autotoc_md17"></a>
4.2. The ExposedClass script</h3>
<p ><a class="el" href="classu_lua_1_1_exposed_class.html" title="Class structure exposed to Lua. You should use this class as a base for your API data structures.">uLua.ExposedClass</a> is intended for data structures which need to be exposed to the Lua API. It is similar to <a class="el" href="classu_lua_1_1_exposed_mono_behaviour.html" title="MonoBehaviour script exposed to Lua. You should use this class as a base for your API game objects.">uLua.ExposedMonoBehaviour</a>, however, the key difference is that <a class="el" href="classu_lua_1_1_exposed_class.html" title="Class structure exposed to Lua. You should use this class as a base for your API data structures.">uLua.ExposedClass</a> is a simple C# class instead of a MonoBehaviour script.</p>
<p >As an example, you may use <a class="el" href="classu_lua_1_1_exposed_class.html" title="Class structure exposed to Lua. You should use this class as a base for your API data structures.">uLua.ExposedClass</a> to describe a weapon item in your game. A simple class definition is the following:</p>
<p ><em><b>Weapon.cs</b></em> </p><div class="fragment"><div class="line">using uLua;</div>
<div class="line"> </div>
<div class="line">public class Weapon : ExposedClass {</div>
<div class="line">    public int Damage = 0;</div>
<div class="line"> </div>
<div class="line">    // Public constructor</div>
<div class="line">    public Weapon(string Name, LuaMonoBehaviour Context = null, bool ExposeOnInit = true, bool EnableResourceScript = false): base(Name, Context, ExposeOnInit, EnableResourceScript) {</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><p >Classes which inherit <a class="el" href="classu_lua_1_1_exposed_class.html" title="Class structure exposed to Lua. You should use this class as a base for your API data structures.">uLua.ExposedClass</a> need to implement the public constructor as shown in the example code above. This is because the base constructor is used to expose the object to the API and to initialise its <code>Name</code> and <code>Context</code> properties.</p>
<p ><em>Note: We have not yet covered what the <code>Context</code> object is, or how to use the <code>EnableResourceScript</code> parameter. These will be explained at a later section.</em></p>
<p >Therefore, to expose an instance of <code>Weapon</code> to Lua, all you need to do is instantiate it with the <code>new</code> keyword. In the following example, we instantiate a <code>Weapon</code> named <code>Sword</code> in the <code>Awake()</code> method of the <code>Player</code> script.</p>
<p ><em><b>Player.cs</b></em> </p><div class="fragment"><div class="line">using uLua;</div>
<div class="line"> </div>
<div class="line">public class Player : ExposedMonoBehaviour {</div>
<div class="line">    private int _Health = 100;</div>
<div class="line"> </div>
<div class="line">    public void Damage(int Damage) {</div>
<div class="line">        _Health -= Damage;</div>
<div class="line"> </div>
<div class="line">        API.Invoke(&quot;PlayerHealthChanged&quot;);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    public int Health {</div>
<div class="line">        get { return _Health; }</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    private void Awake() {</div>
<div class="line">        Weapon Sword = new Weapon(&quot;Sword&quot;);</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><p >As long as this object instantiation is made somewhere in your code, you may access the <code>Sword</code> instance of the <code>Weapon</code> class as a global in Lua. Again, building on the <em>MyGameScene.lua</em> script from the previous section:</p>
<p ><em><b>MyGameScene.lua</b></em> </p><div class="fragment"><div class="line">Sword.Damage = 5;</div>
<div class="line"> </div>
<div class="line">function OnPlayerHealthChanged()</div>
<div class="line">    print (MyPlayer.Health);</div>
<div class="line">end</div>
<div class="line"> </div>
<div class="line">function OnSceneLoaded()</div>
<div class="line">    print (MyPlayer.Health);</div>
<div class="line">    </div>
<div class="line">    MyPlayer:Damage(Sword.Damage);</div>
<div class="line">end</div>
<div class="line"> </div>
<div class="line">function OnSceneUnloaded()</div>
<div class="line">    RemoveEventHandlers();</div>
<div class="line">end</div>
<div class="line"> </div>
<div class="line">RegisterEventHandler(&quot;PlayerHealthChanged&quot;, &quot;OnPlayerHealthChanged&quot;);</div>
<div class="line">RegisterEventHandler(&quot;SceneLoaded&quot;, &quot;OnSceneLoaded&quot;);</div>
<div class="line">RegisterEventHandler(&quot;SceneUnloaded&quot;, &quot;OnSceneUnloaded&quot;);</div>
</div><!-- fragment --><p >In this example we set the value of the <code>Sword.Damage</code> property to 5, and use that as a parameter when calling the method <code>Damage()</code>.</p>
<p >Similarly to <a class="el" href="classu_lua_1_1_exposed_mono_behaviour.html" title="MonoBehaviour script exposed to Lua. You should use this class as a base for your API game objects.">uLua.ExposedMonoBehaviour</a>, the class definition given above will expose all <code>Weapon</code> objects to Lua when they are instantiated. This feature may be disabled by setting the optional <code>ExposeOnInit</code> parameter of the <a class="el" href="classu_lua_1_1_exposed_class.html" title="Class structure exposed to Lua. You should use this class as a base for your API data structures.">uLua.ExposedClass</a> constructor to <code>false</code>, allowing you to expose objects manually by using <a class="el" href="classu_lua_1_1_a_p_i.html#aad4b6cab0c4aac473d9c42aea6902556" title="Exposes an object to Lua.">uLua.API.Expose&lt;T&gt;()</a>. An example of a modified constructor is shown below.</p>
<p ><em><b>Weapon.cs</b></em> </p><div class="fragment"><div class="line">using uLua;</div>
<div class="line"> </div>
<div class="line">public class Weapon : ExposedClass {</div>
<div class="line">    public int Damage = 0;</div>
<div class="line"> </div>
<div class="line">    // Public constructor</div>
<div class="line">    public Weapon(string Name, LuaMonoBehaviour Context = null): base(Name, Context, false) {</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md18"></a>
4.3. Using the Object Context</h3>
<p >In the previous two sections we went over the basics of using <a class="el" href="classu_lua_1_1_exposed_class.html" title="Class structure exposed to Lua. You should use this class as a base for your API data structures.">uLua.ExposedClass</a> and <a class="el" href="classu_lua_1_1_exposed_mono_behaviour.html" title="MonoBehaviour script exposed to Lua. You should use this class as a base for your API game objects.">uLua.ExposedMonoBehaviour</a> classes to expose objects to your API. The <code>Context</code> object is an important feature of these classes.</p>
<p >The <code>Context</code> object allows you to set a hierarchy for objects exposed to your API. If a <code>Context</code> object is not specified, a Lua object is defined as a global by default. This is what we have done so far.</p>
<p >If a <code>Context</code> object is specified, a Lua object is defined as a field of the <code>Context</code> object. This feature may be used for organisation purposes as your API grows in scope.</p>
<p >As an example, we return to the <code>Player</code> and <code>Weapon</code> scripts from the previous section:</p>
<p ><em><b>Player.cs</b></em> </p><div class="fragment"><div class="line">using uLua;</div>
<div class="line"> </div>
<div class="line">public class Player : ExposedMonoBehaviour {</div>
<div class="line">    private int _Health = 100;</div>
<div class="line"> </div>
<div class="line">    public void Damage(int Damage) {</div>
<div class="line">        _Health -= Damage;</div>
<div class="line"> </div>
<div class="line">        API.Invoke(&quot;PlayerHealthChanged&quot;);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    public int Health {</div>
<div class="line">        get { return _Health; }</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    private void Awake() {</div>
<div class="line">        Weapon Sword = new Weapon(&quot;Sword&quot;);</div>
<div class="line">        Weapon PlayerSword = new Weapon(&quot;Sword&quot;, this);</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><p >In this case we have instantiated a second instance of <code>Weapon</code>. Both instances are named <code>Sword</code>. However, the <code>PlayerSword</code> instance is in the context of the <code>Player</code> object. This is indicated by the second parameter (keyword <code>this</code>) in the <code>Weapon()</code> constructor.</p>
<p >To access the non-global <code>Sword</code> object in Lua, you may use the syntax <code>MyPlayer.Sword</code>, as shown below:</p>
<p ><em><b>MyGameScene.lua</b></em> </p><div class="fragment"><div class="line">Sword.Damage = 5;</div>
<div class="line">MyPlayer.Sword.Damage = 2;</div>
<div class="line"> </div>
<div class="line">function OnPlayerHealthChanged()</div>
<div class="line">    print (MyPlayer.Health);</div>
<div class="line">end</div>
<div class="line"> </div>
<div class="line">function OnSceneLoaded()</div>
<div class="line">    print (MyPlayer.Health);</div>
<div class="line">    </div>
<div class="line">    MyPlayer:Damage(Sword.Damage);</div>
<div class="line">end</div>
<div class="line"> </div>
<div class="line">function OnSceneUnloaded()</div>
<div class="line">    RemoveEventHandlers();</div>
<div class="line">end</div>
<div class="line"> </div>
<div class="line">RegisterEventHandler(&quot;PlayerHealthChanged&quot;, &quot;OnPlayerHealthChanged&quot;);</div>
<div class="line">RegisterEventHandler(&quot;SceneLoaded&quot;, &quot;OnSceneLoaded&quot;);</div>
<div class="line">RegisterEventHandler(&quot;SceneUnloaded&quot;, &quot;OnSceneUnloaded&quot;);</div>
</div><!-- fragment --><p >Here we have added a command to set the <code>Sword.Damage</code> property to 2 for the <code>Sword</code> object which is in the context of our <code>MyPlayer</code> object.</p>
<p >The <code>Context</code> is of type <a class="el" href="classu_lua_1_1_lua_mono_behaviour.html" title="MonoBehaviour script which establishes a Lua object framework. For internal use.">uLua.LuaMonoBehaviour</a>, which is the base of <a class="el" href="classu_lua_1_1_exposed_mono_behaviour.html" title="MonoBehaviour script exposed to Lua. You should use this class as a base for your API game objects.">uLua.ExposedMonoBehaviour</a>. As a result, the <code>Context</code> must be a game object, and cannot be a <a class="el" href="classu_lua_1_1_exposed_class.html" title="Class structure exposed to Lua. You should use this class as a base for your API data structures.">uLua.ExposedClass</a> object. To set the context of a <a class="el" href="classu_lua_1_1_exposed_mono_behaviour.html" title="MonoBehaviour script exposed to Lua. You should use this class as a base for your API game objects.">uLua.ExposedMonoBehaviour</a> game object, you can use its public member <code>Context</code> or the inspector UI.</p>
<h3><a class="anchor" id="autotoc_md19"></a>
4.4. Using Object Callback Functions</h3>
<p >In this section we will go over invoking and implementing callback functions for your API objects. This is a feature of both <a class="el" href="classu_lua_1_1_exposed_class.html" title="Class structure exposed to Lua. You should use this class as a base for your API data structures.">uLua.ExposedClass</a> and <a class="el" href="classu_lua_1_1_lua_mono_behaviour.html" title="MonoBehaviour script which establishes a Lua object framework. For internal use.">uLua.LuaMonoBehaviour</a> which allows callback methods to be invoked in Unity and handled in Lua.</p>
<p >The callback system is similar to the event handling system. The key difference is that callbacks are object-specific. In contrast, event handlers may be defined as globals or as members of any object.</p>
<p >Invoking a callback function is as simple as invoking an API event. It is achieved using the methods <a class="el" href="classu_lua_1_1_lua_class.html#a800669071b671d471027c3f261054adc" title="Invokes a Lua callback function.">uLua.ExposedClass.InvokeLua()</a> and <a class="el" href="classu_lua_1_1_lua_mono_behaviour.html#aa874da2a777e09784bb9f9446eb160ff" title="Invokes a Lua callback function.">uLua.ExposedMonoBehaviour.InvokeLua()</a>.</p>
<p >All instances of <a class="el" href="classu_lua_1_1_exposed_class.html" title="Class structure exposed to Lua. You should use this class as a base for your API data structures.">uLua.ExposedClass</a> and <a class="el" href="classu_lua_1_1_exposed_mono_behaviour.html" title="MonoBehaviour script exposed to Lua. You should use this class as a base for your API game objects.">uLua.ExposedMonoBehaviour</a> invoke the "OnLoad" and "OnExit" callbacks by default. "OnLoad" is invoked after the object is first exposed to the API. "OnExit" is invoked when an object is destroyed.</p>
<p >You may invoke these callbacks as needed in your code, and you may invoke custom callbacks as well. In the following piece of code I have invoked the <code>OnDamageTaken</code> callback in the <code>Player</code> script.</p>
<p ><em><b>Player.cs</b></em> </p><div class="fragment"><div class="line">using uLua;</div>
<div class="line"> </div>
<div class="line">public class Player : ExposedMonoBehaviour {</div>
<div class="line">    private int _Health = 100;</div>
<div class="line"> </div>
<div class="line">    public void Damage(int Damage) {</div>
<div class="line">        _Health -= Damage;</div>
<div class="line"> </div>
<div class="line">        API.Invoke(&quot;PlayerHealthChanged&quot;);</div>
<div class="line">        InvokeLua(&quot;OnDamageTaken&quot;);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    public int Health {</div>
<div class="line">        get { return _Health; }</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    public void Awake() {</div>
<div class="line">        Weapon Sword = new Weapon(&quot;Sword&quot;);</div>
<div class="line">        Weapon PlayerSword = new Weapon(&quot;Sword&quot;, this);</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><p >You may implement this callback function anywhere in Lua. The callback function must be a member of a <code>Player</code> object, because it is invoked by the <code>Player</code> script. In this case, our <code>Player</code> object is named <code>MyPlayer</code>, so we implement the <code>OnDamageTaken</code> callback function as member of <code>MyPlayer</code>.</p>
<p ><em><b>MyGameScene.lua</b></em> </p><div class="fragment"><div class="line">Sword.Damage = 5;</div>
<div class="line">MyPlayer.Sword.Damage = 2;</div>
<div class="line"> </div>
<div class="line">function OnPlayerHealthChanged()</div>
<div class="line">    print (MyPlayer.Health);</div>
<div class="line">end</div>
<div class="line"> </div>
<div class="line">function OnSceneLoaded()</div>
<div class="line">    print (MyPlayer.Health);</div>
<div class="line">    </div>
<div class="line">    MyPlayer:Damage(Sword.Damage);</div>
<div class="line">end</div>
<div class="line"> </div>
<div class="line">function MyPlayer:OnDamageTaken()</div>
<div class="line">    print (self.Health);</div>
<div class="line">end</div>
<div class="line"> </div>
<div class="line">function OnSceneUnloaded()</div>
<div class="line">    RemoveEventHandlers();</div>
<div class="line">end</div>
<div class="line"> </div>
<div class="line">RegisterEventHandler(&quot;PlayerHealthChanged&quot;, &quot;OnPlayerHealthChanged&quot;);</div>
<div class="line">RegisterEventHandler(&quot;SceneLoaded&quot;, &quot;OnSceneLoaded&quot;);</div>
<div class="line">RegisterEventHandler(&quot;SceneUnloaded&quot;, &quot;OnSceneUnloaded&quot;);</div>
</div><!-- fragment --><p >In Lua, the ":" syntax in <code>MyPlayer:OnDamageTaken()</code> is used as syntactic sugar to mimic object oriented design. Defining the callback function as <code>MyPlayer:OnDamageTaken()</code> allows use of the <code>self</code> keyword to access members of this object.</p>
<p >In our example, the event <code>PlayerHealthChanged</code> and the callback function <code>OnDamageTaken</code> achieve the same effect. There are operational differences between the two so you must choose whether to use a callback function or an event on a case by case basis. The main differences between the two options are the following:</p><ul>
<li>Event handlers may be defined as globals or as a member of any object. Callback functions are object-specific.</li>
<li>To implement a callback function, you must know the Lua handle of an object (<code>Context.Name</code>) or have a reference to the object, e.g. returned from a function.</li>
</ul>
<h3><a class="anchor" id="autotoc_md20"></a>
4.5. Using Object Resource Scripts</h3>
<p >Another feature of the <a class="el" href="classu_lua_1_1_exposed_class.html" title="Class structure exposed to Lua. You should use this class as a base for your API data structures.">uLua.ExposedClass</a> and <a class="el" href="classu_lua_1_1_exposed_mono_behaviour.html" title="MonoBehaviour script exposed to Lua. You should use this class as a base for your API game objects.">uLua.ExposedMonoBehaviour</a> classes is the ability to execute a Lua script for each object that is exposed to the Lua API. You may use this feature to implement base functionality for your game objects which cannot be modified by external user scripts.</p>
<ul>
<li>To use this feature for instances of <a class="el" href="classu_lua_1_1_exposed_mono_behaviour.html" title="MonoBehaviour script exposed to Lua. You should use this class as a base for your API game objects.">uLua.ExposedMonoBehaviour</a>, you must enable the <code>EnableResourceScript</code> option in the inspector UI of a certain object.</li>
<li>To use this feature for instances of <a class="el" href="classu_lua_1_1_exposed_class.html" title="Class structure exposed to Lua. You should use this class as a base for your API data structures.">uLua.ExposedClass</a>, you must use the <code>EnableResourceScript</code> parameter in the constructor definition of that class. For an example refer to previous implementation of a Weapon class in section 4.2.</li>
</ul>
<p >When the object resource script is enabled, <a class="el" href="namespaceu_lua.html" title="Namespace containing the uLua project.">uLua</a> will execute a Lua script by the name of the object after it is exposed to the API. Object scripts are executed from the <code>ResourcePath</code> under the resource directory in your project.</p>
<p >For instance, for a <code>Player</code> object named <code>MyPlayer</code>, you may place a resource script in the following path:</p>
<div class="fragment"><div class="line">Resources/Scripts/MyPlayer.lua</div>
</div><!-- fragment --><p ><em>Note: This is assuming that the <code>UserScriptsPath</code> is set to its default value of "Scripts".</em></p>
<h3><a class="anchor" id="autotoc_md21"></a>
4.6. Overriding, and Hiding Objects and Members in Lua</h3>
<h4><a class="anchor" id="autotoc_md22"></a>
4.6.1. Overriding Methods</h4>
<p >Allowing users to override a method in a modding framework enables mods to significantly change object behaviour. By default, methods defined in <code>ExposedClass</code> and <code>ExposedMonoBehaviour</code> scripts may not be overridden in Lua.</p>
<p >To allow a method to be overridden in Lua, you may use the the <code>[AllowLuaOverride]</code> attribute. The use of this feature is limited to method calls made in a Lua script. If an overridden method is called in C#, its original implementation will be called instead.</p>
<p >An example is shown below for the <code>Damage()</code> method.</p>
<p ><em><b>Player.cs</b></em> </p><div class="fragment"><div class="line">using uLua;</div>
<div class="line"> </div>
<div class="line">public class Player : ExposedMonoBehaviour {</div>
<div class="line">    private int _Health = 100;</div>
<div class="line"> </div>
<div class="line">    [AllowLuaOverride]</div>
<div class="line">    public void Damage(int Damage) {</div>
<div class="line">        _Health -= Damage;</div>
<div class="line"> </div>
<div class="line">        API.Invoke(&quot;PlayerHealthChanged&quot;);</div>
<div class="line">        InvokeLua(&quot;OnDamageTaken&quot;);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    public int Health {</div>
<div class="line">        get { return _Health; }</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    public void Awake() {</div>
<div class="line">        Weapon Sword = new Weapon(&quot;Sword&quot;);</div>
<div class="line">        Weapon PlayerSword = new Weapon(&quot;Sword&quot;, this);</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><p >You may now use a Lua script (e.g. the object resource script) to override the implementation of that method.</p>
<p ><em><b>MyPlayer.lua</b></em> </p><div class="fragment"><div class="line">function MyPlayer:Damage(Value)</div>
<div class="line">    self.Health = self.Health - Value;</div>
<div class="line">    </div>
<div class="line">    Invoke(&quot;PlayerHealthChanged&quot;);</div>
<div class="line">end</div>
</div><!-- fragment --><h4><a class="anchor" id="autotoc_md23"></a>
4.6.2. Hiding Objects from User Scripts</h4>
<p >It is often useful to hide certain objects of the API from users. To achieve this, you may use the <code>UserBlacklist</code> feature. This is available in the API class through the Unity inspector. Adding the name of a global object to the <code>UserBlacklist</code> list will make it unavailable to user scripts at runtime.</p>
<p >This feature may be used to hide objects of the API from users, while keeping them available to use in-engine.</p>
<h4><a class="anchor" id="autotoc_md24"></a>
4.6.3. Hiding Members</h4>
<p >Sometimes it is unsafe to expose certain class members to your Lua API. To prevent a public member from being exposed to Lua, you may add the relevant MoonSharp attribute to a class:</p>
<div class="fragment"><div class="line">[MoonSharpHideMember(&quot;MemberName&quot;)]</div>
</div><!-- fragment --><p >For instance, if you wanted to hide the <code>Awake()</code> method of the <code>Player</code> script described above, you may use the following syntax:</p>
<p ><em><b>Player.cs</b></em> </p><div class="fragment"><div class="line">using MoonSharp.Interpreter;</div>
<div class="line">using uLua;</div>
<div class="line"> </div>
<div class="line">[MoonSharpHideMember(&quot;Awake&quot;)]</div>
<div class="line">public class Player : ExposedMonoBehaviour {</div>
<div class="line">    private int _Health = 100;</div>
<div class="line"> </div>
<div class="line">    public void Damage(int Damage) {</div>
<div class="line">        _Health -= Damage;</div>
<div class="line"> </div>
<div class="line">        API.Invoke(&quot;PlayerHealthChanged&quot;);</div>
<div class="line">        InvokeLua(&quot;OnDamageTaken&quot;);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    public int Health {</div>
<div class="line">        get { return _Health; }</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    public void Awake() {</div>
<div class="line">        Weapon Sword = new Weapon(&quot;Sword&quot;);</div>
<div class="line">        Weapon PlayerSword = new Weapon(&quot;Sword&quot;, this);</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><p >This would prevent the <code>Awake()</code> method from being called within the Lua API. This could also be achieved by defining the <code>Awake()</code> method as <code>protected</code> or <code>private</code>. However, that would not be an option in cases where a specific member must be public so that other scripts in your project can have access to it.</p>
<h2><a class="anchor" id="autotoc_md25"></a>
5. Saving and Loading Object Data</h2>
<p >The <a class="el" href="classu_lua_1_1_a_p_i.html" title="This script sets up the API framework to your Unity scene.">uLua.API</a> script allows you to save variables of a Lua API object into a file which can then be loaded again at runtime. This feature may be used to save settings or other information and load it seamlessly back into your API in-between playthroughs.</p>
<p >To save data and load for a Lua object, you can use the following commands anywhere in your scene: </p><div class="fragment"><div class="line">uLua.API.SaveData();</div>
<div class="line">uLua.API.LoadSavedData();</div>
</div><!-- fragment --><p >These methods take 2 arguments:</p><ul>
<li><em>LuaMonoBehaviour Object</em>: The object for which data will be saved or loaded.</li>
<li><em>string Index</em>: (Optional) The index of the data to be saved or loaded. Default value is "SaveData".</li>
</ul>
<p >For more information, check out the full documentation below:</p>
<p ><a class="el" href="classu_lua_1_1_a_p_i.html#a4feae7dfb393e8a11f907a96c25ef14b" title="Saves table data from the specified object.">uLua.API.SaveData()</a>;</p>
<p ><a class="el" href="classu_lua_1_1_a_p_i.html#a2d362a6db6d3e03ce35e85eada11c8bc" title="Loads table data saved for the specified object.">uLua.API.LoadSavedData()</a>;</p>
<p >You may save any number of variables, however, the save data must be in the format of a Lua table. The data with the index "SaveData" is saved by default, unless specified otherwise by the second argument of <code>SaveData()</code> and <code>LoadSavedData()</code>.</p>
<p >For instance, the following Lua table could be used to store the position of the <code>MyPlayer</code> object we defined in section 4.</p>
<div class="fragment"><div class="line">MyPlayer.SaveData = {</div>
<div class="line">    [&quot;X&quot;] = 10,</div>
<div class="line">    [&quot;Y&quot;] = -10,</div>
<div class="line">}</div>
</div><!-- fragment --><p >The members of the table determine what information will be saved. Nested tables are not supported.</p>
<p >The SaveData table may be defined anywhere in Lua:</p><ul>
<li>in a scene script,</li>
<li>in an object resource script, or</li>
<li>in user scripts.</li>
</ul>
<p >You can then call the the saving/loading methods as required in your code. For instance, you may use Unity's <code>Start()</code> and <code>OnDestroy()</code> methods. Returning to the previous example of a <code>Player</code> script:</p>
<p ><em><b>Player.cs</b></em> </p><div class="fragment"><div class="line">using uLua;</div>
<div class="line"> </div>
<div class="line">public class Player : ExposedMonoBehaviour {</div>
<div class="line">    private int _Health = 100;</div>
<div class="line"> </div>
<div class="line">    public void Damage(int Damage) {</div>
<div class="line">        _Health -= Damage;</div>
<div class="line"> </div>
<div class="line">        API.Invoke(&quot;PlayerHealthChanged&quot;);</div>
<div class="line">        InvokeLua(&quot;OnDamageTaken&quot;);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    public int Health {</div>
<div class="line">        get { return _Health; }</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    public void Awake() {</div>
<div class="line">        Weapon Sword = new Weapon(&quot;Sword&quot;);</div>
<div class="line">        Weapon PlayerSword = new Weapon(&quot;Sword&quot;, this);</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    protected override Start()</div>
<div class="line">        base.Start();</div>
<div class="line">        </div>
<div class="line">        API.LoadSavedData(this);</div>
<div class="line">    end</div>
<div class="line">    </div>
<div class="line">    protected override void OnDestroy() {</div>
<div class="line">        base.OnDestroy();</div>
<div class="line"> </div>
<div class="line">        API.SaveData(this);</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><p >These methods are also available in the Lua API as globals with the same arguments:</p>
<div class="fragment"><div class="line">SaveData();</div>
<div class="line">LoadSavedData();</div>
</div><!-- fragment --><p >and may be implemented similarly in <code>OnLoad</code> and <code>OnExit</code> callbacks. For example:</p>
<p ><em><b>MyUserScript.lua</b></em> </p><div class="fragment"><div class="line">function MyPlayer:OnLoad()</div>
<div class="line">    LoadSavedData(self);</div>
<div class="line">end</div>
<div class="line"> </div>
<div class="line">function MyPlayer:OnExit()</div>
<div class="line">    SaveData(self);</div>
<div class="line">end</div>
</div><!-- fragment --><p >Keep in mind that in both cases the <code>MyPlayer.SaveData</code> table always has to be updated with the current values of X and Y before calling the <code>SaveData()</code> method. The Lua callback <code>OnExit</code> would be a suitable place to do this in both cases.</p>
<h2><a class="anchor" id="autotoc_md26"></a>
6. Message, warning, and error logging</h2>
<p >You may use the following commands for message logging and error reporting in Lua:</p>
<div class="fragment"><div class="line">print(&quot;Hello World!&quot;);</div>
<div class="line">LogWarning(&quot;Hello World!&quot;);</div>
<div class="line">LogError(&quot;Hello World!&quot;);</div>
</div><!-- fragment --><p >These commands are linked to Unity's corresponding <code>Debug.Log()</code>, <code>Debug.LogWarning()</code>, and <code>Debug.LogError()</code>, which means that any messages printed in Lua will also be printed to the console in the Unity editor.</p>
<p >Finally, these commands trigger the following events in Lua:</p>
<div class="fragment"><div class="line">LuaMessageLogged</div>
<div class="line">LuaWarningLogged</div>
<div class="line">LuaErrorLogged</div>
</div><!-- fragment --><p >The first parameter passed in an event handler for these events contains the string that was logged. For instance:</p>
<div class="fragment"><div class="line">function OnLuaMessageLogged(Text)</div>
<div class="line">    -- &#39;Text&#39; contains the string &quot;Hello World!&quot;</div>
<div class="line">    -- Do stuff</div>
<div class="line">end</div>
<div class="line"> </div>
<div class="line">RegisterEventHandler(&quot;LuaMesageLogged&quot;, &quot;OnLuaMessageLogged&quot;);</div>
<div class="line"> </div>
<div class="line">print(&quot;Hello World!&quot;);</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md27"></a>
7. Further Support</h2>
<p >This covers a large portion of the features in uLua! I hope that this tutorial together with the documentation are enough to get you started on your API development. However, for any further questions do not hesitate to contact <a href="#" onclick="location.href='mai'+'lto:'+'sup'+'po'+'rt@'+'an'+'tso'+'ft'+'war'+'e.'+'co.'+'uk'; return false;">suppo<span class="obfuscator">.nosp@m.</span>rt@a<span class="obfuscator">.nosp@m.</span>ntsof<span class="obfuscator">.nosp@m.</span>twar<span class="obfuscator">.nosp@m.</span>e.co.<span class="obfuscator">.nosp@m.</span>uk</a>.</p>
<p >I have put together a demo paddle game project which utilises <a class="el" href="namespaceu_lua.html" title="Namespace containing the uLua project.">uLua</a>, and which comes with its own documentation of the API and source code. You may find it <a href="https://bit.ly/PaddleDemo">here</a>.</p>
<p >This project is the result of many hours of hard work. Please support me by leaving a review on the asset store! Also, follow my <a href="https://twitter.com/_ANTSoftware" title="@_ANTSoftware">Twitter</a>! </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.4 </li>
  </ul>
</div>
</body>
</html>
